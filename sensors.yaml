  - platform: airvisual
    api_key: !secret airvisual_key
    monitored_conditions:
      - us

  - platform: darksky
    api_key: !secret darksky_key
    scan_interval:
      minutes: 12
    forecast:
    - 0
    hourly_forecast:
    - 1
    - 2
    - 3
    - 4
    - 5
    - 6
    - 7
    - 8
    - 9
    monitored_conditions:
    - temperature_high
    - temperature_low
    - apparent_temperature_high
    - apparent_temperature_low
    - summary
    - icon
    - nearest_storm_distance
    - precip_type
    - precip_intensity
    - precip_probability
    - temperature
    - apparent_temperature
    - dew_point
    - wind_speed
    - wind_bearing
    - wind_gust
    - cloud_cover
    - humidity
    - pressure
    - visibility
    - ozone
    - minutely_summary
    - hourly_summary
    - daily_summary

  - platform: imap_email_content
    server: imap.gmail.com
    name: cp_packages_coming_today
    port: 993
    username: !secret gmail_uname
    password: !secret hass_pass
    senders:
    - !secret my_email
    - ceskaposta@cpost.cz
    - !secret wife_email
    value_template: >-
      {% if 'Informace o Vaší zásilce' in subject %}
        Delivery
      {% elif 'reset state of package sensor' in subject %}
        no_delivery
      {% endif %}

  - platform: imap_email_content
    server: imap.gmail.com
    name: dpd_packages_coming_today
    port: 993
    username: !secret gmail_uname
    password: !secret hass_pass
    senders:
    - !secret my_email
    - NOREPLY@dpd.cz
    - !secret wife_email
    value_template: >-
      {% if 'Dnes Vám' in subject %}
        Delivery
      {% elif 'reset state of package sensor' in subject %}
        no_delivery
      {% endif %}

  - platform: imap_email_content
    server: imap.gmail.com
    name: dhl_packages_coming_today
    port: 993
    username: !secret gmail_uname
    password: !secret hass_pass
    senders:
    - !secret my_email
    - NoReply.ODD@dhl.com
    - !secret wife_email
    value_template: >-
      {% if 'DHL On Demand Delivery' in subject %}
        Delivery
      {% elif 'reset state of package sensor' in subject %}
        no_delivery
      {% endif %}

  - platform: imap_email_content
    server: imap.gmail.com
    name: gls_packages_coming_today
    port: 993
    username: !secret gmail_uname
    password: !secret hass_pass
    senders:
    - !secret my_email
    - noreply@gls-czech.com
    - !secret wife_email
    value_template: >-
      {% if 'Informace o času doručení balíku' in subject %}
        Delivery
      {% elif 'reset state of package sensor' in subject %}
        no_delivery
      {% endif %}

  - platform: imap_email_content
    server: imap.gmail.com
    name: house_electricity
    port: 993
    username: !secret gmail_uname
    password: !secret hass_pass
    senders:
    - !secret my_email
    - no-reply@smartconnect.apc.com
    value_template: >-
      {% if 'UPS On Battery' in subject %}
        power_out
      {% elif 'Power Restored' in subject %}
        power_on
      {% endif %}

#  - platform: gtfs
#    name: transport
#    origin: U49Z4
#    destination: U484Z2
#    data: jrdata.zip

  - platform: template
    sensors:
      bike_day:
        friendly_name: "Bike Day"
        value_template: >-
          {% if states('sensor.dark_sky_daytime_high_temperature_0d')|float < 27
             and states('sensor.dark_sky_temperature')|float > 14 
             and states('sensor.dark_sky_wind_gust')|float < 20
             and (states('sensor.dark_sky_precip_probability_0d')|float < 30
             or ((states('sensor.dark_sky_precip_intensity_1h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_2h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_3h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_4h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_5h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_6h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_7h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_8h')|float < 0.05)
             and (states('sensor.dark_sky_precip_intensity_9h')|float < 0.05))) %}
            yes
          {% else %}
            no
          {% endif %}

#             and (((states('sensor.dark_sky_precip_probability_1h')|float
#             + states('sensor.dark_sky_precip_probability_2h')|float
#             + states('sensor.dark_sky_precip_probability_3h')|float
#             + states('sensor.dark_sky_precip_probability_4h')|float
#             + states('sensor.dark_sky_precip_probability_5h')|float
#             + states('sensor.dark_sky_precip_probability_6h')|float
#             + states('sensor.dark_sky_precip_probability_7h')|float
#             + states('sensor.dark_sky_precip_probability_8h')|float
#             + states('sensor.dark_sky_precip_probability_9h')|float) < 60 )        
        
#          {% if states('sensor.dark_sky_precip_probability')|float < 30 
#             and states('sensor.dark_sky_daytime_high_temperature_0d')|float < 27
#             and states('sensor.dark_sky_temperature')|float > 14 
#             and states('sensor.dark_sky_wind_gust')|float < 20
#             and states('sensor.dark_sky_precip_probability_1h')|float < 30
#             and states('sensor.dark_sky_precip_probability_2h')|float < 30
#             and states('sensor.dark_sky_precip_probability_3h')|float < 30
#             and states('sensor.dark_sky_precip_probability_4h')|float < 30
#             and states('sensor.dark_sky_precip_probability_5h')|float < 30
#             and states('sensor.dark_sky_precip_probability_6h')|float < 30
#             and states('sensor.dark_sky_precip_probability_7h')|float < 30
#             and states('sensor.dark_sky_precip_probability_8h')|float < 30
#             and states('sensor.dark_sky_precip_probability_9h')|float < 30 %}
#            yes
#          {% else %}
#            no
#          {% endif %}



#
#  - platform: template
#    sensors:
#      last_human_left:
#        friendly_name: "Last Human-Left"
#        value_template: >-
#          {% if states('sensor.left_human_detection') | float > 16 %}
#            Person Detected
#          {% else %}
#            {{states('sensor.last_human_left')}}
#          {% endif %}
#
#  - platform: template
#    sensors:
#      last_human_right:
#        friendly_name: "Last Human-Right"
#        value_template: >-
#          {% if states('sensor.right_human_detection') | float > 16 %}
#            Person Detected
#          {% else %}
#            {{states('sensor.right_human_right')}}
#          {% endif %}
#
#  - platform: template
#    sensors:
#      last_human_front:
#        friendly_name: "Last Human-Front"
#        value_template: >-
#          {% if states('sensor.front_human_detection') | float > 16 %}
#            Person Detected
#          {% else %}
#            {{states('sensor.last_human_front')}}
#          {% endif %}
#
#  - platform: template
#    sensors:
#      last_human_back:
#        friendly_name: "Last Human-Back"
#        value_template: >-
#          {% if states('sensor.back_human_detection') | float > 16 %}
#            Person Detected
#          {% else %}
#            {{states('sensor.back_human_left')}}
#          {% endif %}

#  - platform: gtfs_realtime
#    trip_update_url: 'http://opendata.iprpraha.cz/DPP/JR/jrdata.zip'
#    departures:
#    - name: transit
#      route: 5
#      stopid: U49N198

  - platform: template
    sensors:
      alenas_phone_battery:
        friendly_name: "Alena's Phone Battery"
        value_template: >-
          {% if is_state('sensor.alena_s_iphone_battery_state', 'Charging') %}
            Charging
          {% elif states('sensor.alena_s_iphone_battery_level')|float < 15 %}
            Very Low
          {% elif states('sensor.alena_s_iphone_battery_level')|float < 25 %}
            Low
          {% elif states('sensor.alena_s_iphone_battery_level')|float < 40 %}
            Needs Charging
          {% elif states('sensor.alena_s_iphone_battery_level')|float < 70 %}
            Good
          {% else %}
            Charged
          {% endif %}

  - platform: template
    sensors:
      sophies_phone_battery:
        friendly_name: "Sophie's Phone Battery"
        value_template: >-
          {% if is_state('sensor.sophies_iphone_6_battery_state', 'Charging') %}
            Charging
          {% elif states('sensor.sophies_iphone_6_battery_level')|float < 15 %}
            Very Low
          {% elif states('sensor.sophies_iphone_6_battery_level')|float < 25 %}
            Low
          {% elif states('sensor.sophies_iphone_6_battery_level')|float < 40 %}
            Needs Charging
          {% elif states('sensor.sophies_iphone_6_battery_level')|float < 70 %}
            Good
          {% else %}
            Charged
          {% endif %}

  - platform: template
    sensors:
      closet_window_sensor_1_battery:
        friendly_name: "Closet Window Sensor 1 Battery"
        value_template: >-
          {% if state_attr('zwave.closet_window_1', 'battery_level')|float < 15 %}
            Very Low
          {% elif state_attr('zwave.closet_window_1', 'battery_level')|float < 25 %}
            Low
          {% elif state_attr('zwave.closet_window_1', 'battery_level')|float < 40 %}
            Medium
          {% elif state_attr('zwave.closet_window_1', 'battery_level')|float < 70 %}
            Good
          {% else %}
            Full
          {% endif %}  

  - platform: template
    sensors:
      back_door_sensor_battery:
        friendly_name: "Back Door Sensor Battery"
        value_template: >-
          {% if state_attr('zwave.back_door', 'battery_level')|float < 15 %}
            Very Low
          {% elif state_attr('zwave.back_door', 'battery_level')|float < 25 %}
            Low
          {% elif state_attr('zwave.back_door', 'battery_level')|float < 40 %}
            Medium
          {% elif state_attr('zwave.back_door', 'battery_level')|float < 70 %}
            Good
          {% else %}
            Full
          {% endif %}            

  - platform: template
    sensors:
      guest_bedroom_window_1_battery:
        friendly_name: "Guest Bedroom Window 1 Sensor Battery"
        value_template: >-
          {% if state_attr('zwave.guest_bedroom_window_1', 'battery_level')|float < 15 %}
            Very Low
          {% elif state_attr('zwave.guest_bedroom_window_1', 'battery_level')|float < 25 %}
            Low
          {% elif state_attr('zwave.guest_bedroom_window_1', 'battery_level')|float < 40 %}
            Medium
          {% elif state_attr('zwave.guest_bedroom_window_1', 'battery_level')|float < 70 %}
            Good
          {% else %}
            Full
          {% endif %}            


#  - platform: template
#    sensors:
#      back_door:
#        friendly_name: "Back Door"
#        value_template: >-
#          {% if is_state('binary_sensor.neo_coolcam_door_window_detector_sensor_2', 'off') %}
#            Closed
#          {% elif is_state('binary_sensor.neo_coolcam_door_window_detector_sensor_2', 'on') %}
#            Open
#          {% endif %}
#        icon_template: >-
#          {% if is_state('binary_sensor.neo_coolcam_door_window_detector_sensor_2', 'off') %}
#            mdi:door
#          {% elif is_state('binary_sensor.neo_coolcam_door_window_detector_sensor_2', 'on') %}
#            mdi:door-open
#          {% endif %}
#
#  - platform: template
#    sensors:
#      closet_window:
#        friendly_name: "Closet Window"
#        value_template: >-
#          {% if is_state('binary_sensor.neo_coolcam_door_window_detector_sensor', 'off') %}
#            Closed
#          {% elif is_state('binary_sensor.neo_coolcam_door_window_detector_sensor', 'on') %}
#            Open
#          {% endif %}
#        icon_template: >-
#          {% if is_state('binary_sensor.neo_coolcam_door_window_detector_sensor', 'off') %}
#            mdi:window-closed
#          {% elif is_state('binary_sensor.neo_coolcam_door_window_detector_sensor', 'on') %}
#            mdi:window-open
#          {% endif %}

  - platform: template
    sensors:
      seans_phone_battery:
        friendly_name: "Sean's Phone Battery"
        value_template: >-
          {% if is_state('sensor.sean_s_iphone_x_battery_state', 'Charging') %}
            Charging
          {% elif states('sensor.sean_s_iphone_x_battery_level')|float < 15 %}
            Very Low
          {% elif states('sensor.sean_s_iphone_x_battery_level')|float < 25 %}
            Low
          {% elif states('sensor.sean_s_iphone_x_battery_level')|float < 40 %}
            Needs Charging
          {% elif states('sensor.sean_s_iphone_x_battery_level')|float < 70 %}
            Good
          {% else %}
            Charged
          {% endif %}

  - platform: waze_travel_time
    origin: !secret home_address
    destination: !secret work_address
    region: 'EU'
    name: Driving Time to Work
 
  - platform: waze_travel_time
    origin: device_tracker.seans_iphone_x
    destination: zone.home
    region: 'EU'
    name: Sean Driving Time to Home

  - platform: waze_travel_time
    origin: device_tracker.alenas_iphone
    destination: zone.home
    region: 'EU'
    name: Alena Driving Time to Home
 
  - platform: waze_travel_time
    origin: device_tracker.sophie
    destination: zone.home
    region: 'EU'
    name: Sophie Driving Time to Home
 
  - platform: google_travel_time
    api_key: !secret google_travel_key
    origin: device_tracker.seans_iphone_x
    destination: zone.home
    name: Sean Tram Time to Home
    options:
      mode: transit

  - platform: google_travel_time
    api_key: !secret google_travel_key
    origin: device_tracker.sophie
    destination: zone.home
    name: Sophie Tram Time to Home
    options:
      mode: transit

#  - platform: google_travel_time
#    api_key: !secret google_travel_key
#    origin: zone.home
#    destination: zone.work
#    name: Sean Tram Time to Work
#    options:
#      mode: transit

  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: disk_free
        arg: /
      - type: memory_use_percent
      - type: load_15m
      - type: processor_use

  - platform: template
    sensors:
      sean_location:
        value_template: '{{ states.input_select.sean_location_dropdown.state }}'
        friendly_name: "Papa Is:"
        icon_template: >-
          {% if is_state('input_select.sean_location_dropdown', 'Home') %}
            mdi:home
          {% elif is_state('input_select.sean_location_dropdown', 'At Work') %}
            mdi:briefcase
          {% elif is_state('input_select.sean_location_dropdown', 'At Andel') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At WineFood') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At Hornbach') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At Ikea') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At Billa') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At BioStore') %}
            mdi:cart
          {% elif is_state('input_select.sean_location_dropdown', 'At Posta') %}
            mdi:email            
          {% elif is_state('input_select.sean_location_dropdown', 'At Yoga') %}
            mdi:human-handsup
          {% elif is_state('input_select.sean_location_dropdown', 'Traveling') %}
            mdi:airplane
          {% elif is_state('input_select.sean_location_dropdown', 'ParklaneValdstejnska') %}
            mdi:school
          {% else %}
            mdi:train-car
          {% endif %}

  - platform: template
    sensors:
      alena_location:
        friendly_name: "Mama Is:"
        value_template: >-          
          {% if is_state('device_tracker.alenas_iphone', 'home') %}
            Home
          {% elif is_state('device_tracker.alenas_iphone', 'Andel') %}
            At Andel
          {% elif is_state('device_tracker.alenas_iphone', 'WineFood') %}
            At WineFood
          {% elif is_state('device_tracker.alenas_iphone', 'Hornbach') %}
            At Hornbach
          {% elif is_state('device_tracker.alenas_iphone', 'Ikea') %}
            At Ikea
          {% elif is_state('device_tracker.alenas_iphone', 'Billa') %}
            At Billa
          {% elif is_state('device_tracker.alenas_iphone', 'BioStore') %}
            At Bio Store
          {% elif is_state('device_tracker.alenas_iphone', 'Posta') %}
            At Posta
          {% elif is_state('device_tracker.alenas_iphone', 'Yoga') %}
            At Yoga
          {% elif is_state('device_tracker.alenas_iphone', 'LittleGym') %}
            At Little Gym
          {% elif is_state('device_tracker.alenas_iphone', 'ParklaneValdejnska') %}
            At Parklane Valdejnska
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp6') %}
            At CMC in P6
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp4') %}
            At CMC in P4
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp5') %}
            At CMC in P5
          {% elif is_state('device_tracker.alenas_iphone', 'EUCp4') %}
            At EUC in P4
          {% elif is_state('device_tracker.alenas_iphone', 'EUCp1') %}
            At EUC in P1
          {% elif is_state('device_tracker.alenas_iphone', 'Zlichov') %}
            At Zlichov
          {% elif is_state('device_tracker.alenas_iphone', 'Malostranska') %}
            At Malostranska
          {% elif states('proximity.alena_home')|float > 120 %}
            Traveling
          {% elif is_state('sensor.alena_direction_of_travel', 'away_from') %}
            Leaving Home
          {% elif is_state('sensor.alena_direction_of_travel', 'stationary') %}
            Somewhere
          {% elif is_state('sensor.alena_direction_of_travel', 'towards') %}
            Heading Home
          {% else %}
            Somewhere
          {% endif %}
        icon_template: >-
          {% if is_state('device_tracker.alenas_iphone', 'home') %}
            mdi:home
          {% elif is_state('device_tracker.alenas_iphone', 'Andel') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'WineFood') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'Hornbach') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'Ikea') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'Billa') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'BioStore') %}
            mdi:cart
          {% elif is_state('device_tracker.alenas_iphone', 'Posta') %}
            mdi:email
          {% elif is_state('device_tracker.alenas_iphone', 'Yoga') %}
            mdi:human-handsup
          {% elif is_state('device_tracker.alenas_iphone', 'LittleGym') %}
            mdi:human-handsup
          {% elif is_state('device_tracker.alenas_iphone', 'Traveling') %}
            mdi:airplane
          {% elif is_state('device_tracker.alenas_iphone', 'ParklaneValdstejnska') %}
            mdi:school
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp6') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp4') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.alenas_iphone', 'CMCp5') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.alenas_iphone', 'EUCp4') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.alenas_iphone', 'EUCp1') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.alenas_iphone', 'Zlichov') %}
            mdi:tram
          {% elif is_state('device_tracker.alenas_iphone', 'Malostranska') %}
            mdi:tram
          {% elif is_state('sensor.alena_direction_of_travel', 'stationary') %}
            mdi:help
          {% elif is_state('sensor.alena_direction_of_travel', 'away_from') %}
            mdi:car
          {% elif is_state('sensor.alena_direction_of_travel', 'towards') %}
            mdi:car
          {% elif states('proximity.alena_home')|float > 120 %}
            mdi:airplane
          {% else %}
            mdi:help
          {% endif %}


  - platform: template
    sensors:
      sophie_location:
        friendly_name: "Sophie Is:"
        value_template: >-          
          {% if is_state('device_tracker.sophie', 'home') %}
            Home
          {% elif is_state('device_tracker.sophie', 'Andel') %}
            At Andel
          {% elif is_state('device_tracker.sophie', 'WineFood') %}
            At WineFood
          {% elif is_state('device_tracker.sophie', 'Parklane Valdstejnska') %}
            At School
          {% elif is_state('device_tracker.sophie', 'Hornbach') %}
            At Hornbach
          {% elif is_state('device_tracker.sophie', 'Ikea') %}
            At Ikea
          {% elif is_state('device_tracker.sophie', 'Billa') %}
            At Billa
          {% elif is_state('device_tracker.sophie', 'BioStore') %}
            At Bio Store
          {% elif is_state('device_tracker.sophie', 'Posta') %}
            At Posta
          {% elif is_state('device_tracker.sophie', 'Yoga') %}
            At Yoga
          {% elif is_state('device_tracker.sophie', 'LittleGym') %}
            At Little Gym
          {% elif is_state('device_tracker.sophie', 'Airport') %}
            At Airport
          {% elif is_state('device_tracker.sophie', 'ParklaneValdejnska') %}
            At School
          {% elif is_state('device_tracker.sophie', 'CMCp6') %}
            At CMC in P6
          {% elif is_state('device_tracker.sophie', 'CMCp4') %}
            At CMC in P4
          {% elif is_state('device_tracker.sophie', 'CMCp5') %}
            At CMC in P5
          {% elif is_state('device_tracker.sophie', 'EUCp4') %}
            At EUC in P4
          {% elif is_state('device_tracker.sophie', 'EUCp1') %}
            At EUC in P1
          {% elif is_state('device_tracker.sophie', 'Zlichov') %}
            At Zlichov
          {% elif is_state('device_tracker.sophie', 'Malostranska') %}
            At Malostranska
          {% elif states('proximity.sophie_home')|float > 120 %}
            Traveling
          {% elif is_state('sensor.sophie_direction_of_travel', 'away_from') %}
            Leaving Home
          {% elif is_state('sensor.sophie_direction_of_travel', 'stationary') %}
            Somewhere
          {% elif is_state('sensor.sophie_direction_of_travel', 'towards') %}
            Heading Home
          {% endif %}
        icon_template: >-
          {% if is_state('device_tracker.sophie', 'home') %}
            mdi:home
          {% elif is_state('device_tracker.sophie', 'Parklane Valdstejnska') %}
            mdi:school
          {% elif is_state('device_tracker.sophie', 'Andel') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'WineFood') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'Hornbach') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'Ikea') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'Billa') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'BioStore') %}
            mdi:cart
          {% elif is_state('device_tracker.sophie', 'Posta') %}
            mdi:email            
          {% elif is_state('device_tracker.sophie', 'Yoga') %}
            mdi:human-handsup  
          {% elif is_state('device_tracker.sophie', 'LittleGym') %}
            mdi:human-handsup  
          {% elif is_state('device_tracker.sophie', 'Airport') %}
            mdi:airplane
          {% elif is_state('device_tracker.sophie', 'ParklaneValdstejnska') %}
            mdi:school
          {% elif is_state('device_tracker.sophie', 'CMCp6') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.sophie', 'CMCp4') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.sophie', 'CMCp5') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.sophie', 'EUCp4') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.sophie', 'EUCp1') %}
            mdi:local_hospital
          {% elif is_state('device_tracker.sophie', 'Zlichov') %}
            mdi:tram
          {% elif is_state('device_tracker.sophie', 'Malostranska') %}
            mdi:tram
          {% elif states('proximity.sophie_home')|float > 120 %}
            mdi:airplane
          {% elif is_state('sensor.sophie_direction_of_travel', 'stationary') %}
            mdi:help
          {% else %}
            mdi:train-car
          {% endif %}

#  - platform: deluge
#    host: !secret deluge_ip
#    username: !secret deluge_uname
#    password: !secret deluge_pw
#    monitored_variables:
#      - 'current_status'
#      - 'download_speed'
#      - 'upload_speed'
      
  - platform: template
    sensors:
      sean_direction_of_travel:
        friendly_name: "Sean is Heading"
        value_template: "{{ state_attr('proximity.sean_home', 'dir_of_travel') }}"

      alena_direction_of_travel:
        friendly_name: "Alena is Heading"
        value_template: "{{ state_attr('proximity.alena_home', 'dir_of_travel') }}"

      sophie_direction_of_travel:
        friendly_name: "Sophie is Heading"
        value_template: "{{ state_attr('proximity.sophie_home', 'dir_of_travel') }}"

      all_direction_of_travel:
        friendly_name: "All are Heading"
        value_template: "{{ state_attr('proximity.all_home', 'dir_of_travel') }}"

#  - name: Right Human Detection
#    platform: mqtt
#    state_topic: "cameras/1/objects"
#    value_template: '{{ value_json.person }}'
#    unit_of_measurement: '%'
#    availability_topic: "cameras/1/available"
#
#  - name: Left Human Detection
#    platform: mqtt
#    state_topic: "cameras/2/objects"
#    value_template: '{{ value_json.person }}'
#    unit_of_measurement: '%'
#    availability_topic: "cameras/2/available"
#
#  - name: Front Human Detection
#    platform: mqtt
#    state_topic: "cameras/3/objects"
#    value_template: '{{ value_json.person }}'
#    unit_of_measurement: '%'
#    availability_topic: "cameras/3/available"
#
#  - name: Back Human Detection
#    platform: mqtt
#    state_topic: "cameras/4/objects"
#    value_template: '{{ value_json.person }}'
#    unit_of_measurement: '%'
#    availability_topic: "cameras/4/available"

#  - platform: smartthinq_washer
#    name: LG_Washer
#    mac: !secret lg_washer_mac        

  - name: Alarm State 1 - Laundry
    platform: mqtt
    state_topic: 'paradox/alarm/state/1'

  - name: Alarm State 2 - 1st Floor
    platform: mqtt
    state_topic: 'paradox/alarm/state/2'
    
  - name: Alarm State 3 - Motion Sensors
    platform: mqtt
    state_topic: 'paradox/alarm/state/3'

#  - name: Home Air Quality
#    platform: file
#    file_path: "/share/avnodehome/Latest_AirVisual_values.txt"
#    value_template: '{{ value.split(";")[4] }}'
#    unit_of_measurement: 'AQI'


# 04/01-11/25: Pickup is Even Weeks Monday Morning. Formula is Odd Weeks on Sunday = Today, Odd Weeks on Saturday = Tomorrow. 

  - platform: template
    sensors:
      bio_odpad_day:
        friendly_name: "Take Bio Odpad Out"
        entity_id: sensor.date
        value_template: >-
          {% if (now().isocalendar()[1]/2)|round(0) != (now().isocalendar()[1]/2)  
          and now().weekday() in (6,) 
          and now().strftime('%F') <= (now().strftime('%Y') | int ) ~ "-11-25" 
          and now().strftime('%F') >= (now().strftime('%Y') | int ) ~ "-04-01" %}
            Today
          {% elif (now().isocalendar()[1]/2)|round(0) != (now().isocalendar()[1]/2)  
          and now().weekday() in (5,) 
          and now().strftime('%F') <= (now().strftime('%Y') | int ) ~ "-11-25" 
          and now().strftime('%F') >= (now().strftime('%Y') | int ) ~ "-04-01" %}
            Tomorrow
          {% else %}
            false
          {% endif %}

  - platform: template
    sensors:
      trash_day:
        friendly_name: "Take Trash Out"
        entity_id: sensor.date
        value_template: >-
          {% if now().weekday() in (2,) %}
            Today
          {% elif now().weekday() in (1,) %}
            Tomorrow
          {% else %}
            false
          {% endif %}

  - platform: synologydsm
    name: discworld
    host: !secret synology_ip
    username: !secret syn_uname
    password: !secret hass_pass
    monitored_conditions:
      - cpu_total_load
      - memory_real_usage
      - network_up
      - network_down
      - disk_smart_status
      - volume_percentage_used


  - platform: template
    sensors:
      dining_room_temperature:
        friendly_name: "Temperature-Dining Room"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.dining_room', 'current_temperature')|float }}"

      entrance_temperature:
        friendly_name: "Temperature-Entrance"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.entrance', 'current_temperature')|float }}"

      garage_temperature:
        friendly_name: "Temperature-Garage"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.garage', 'current_temperature')|float }}"

      guest_bedroom_temperature:
        friendly_name: "Temperature-Guest Bedroom"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.guest_bedroom', 'current_temperature')|float }}"

      laundry_room_temperature:
        friendly_name: "Temperature-Laundry Room"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.laundry_room', 'current_temperature')|float }}"

      living_room_temperature:
        friendly_name: "Temperature-Living Room"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.living_room', 'current_temperature')|float }}"

      master_bath_temperature:
        friendly_name: "Temperature-Master Bath"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.master_bath', 'current_temperature')|float }}"

      master_bedroom_temperature:
        friendly_name: "Temperature-Master Bedroom"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.master_bedroom', 'current_temperature')|float }}"

      master_closet_temperature:
        friendly_name: "Temperature-Master Closet"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.master_closet', 'current_temperature')|float }}"

      office_library_temperature:
        friendly_name: "Temperature-Office/Libary"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.office_library', 'current_temperature')|float }}"

      sebastian_s_room_temperature:
        friendly_name: "Temperature-Sebastian's Room"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.sebastian_s_room', 'current_temperature')|float }}"

      sophie_s_room_temperature:
        friendly_name: "Temperature-Sophie's Room"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.sophie_s_room', 'current_temperature')|float }}"

      straus_house_temperature:
        friendly_name: "Temperature-Straus House"
        device_class: temperature
        unit_of_measurement: C
        value_template: "{{ state_attr('climate.straus_house', 'current_temperature')|float }}"

  - platform: template
    sensors:
    
      discworld_network_down_mbit:
        friendly_name: "Discworld Network Down Mbit"
        unit_of_measurement: 'Mbit/s'
        value_template: "{{ states('sensor.discworld_network_down')|float / 1024 }}"

      discworld_network_up_mbit:
        friendly_name: "Discworld Network Up Mbit"
        unit_of_measurement: 'Mbit/s'
        value_template: "{{ states('sensor.discworld_network_up')|float / 1024 }}"

  - platform: here_travel_time
    name: transport_time_to_work
    mode: publicTransportTimeTable
    traffic_mode: true
    app_id: !secret here_app_id
    app_code: !secret here_app_code
    origin: !secret home_lat_long
    destination: !secret work_lat_long
    unit_system: metric
    scan_interval: 60

  - platform: template
    sensors:
      alena_eta_description:
        friendly_name: "Alena ETA description"
        value_template: >-
          {% if is_state('sensor.alena_direction_of_travel', 'away_from') %}Alena is heading away from home. But if she were to turn around and start driving home now, it would take her approximately {{ states('sensor.alena_driving_time_to_home') }} minutes if she's driving in a car.
          {% elif is_state('sensor.alena_location', 'Somewhere') %}Alena is somewhere I don't know. She hasn't started heading home yet, but if she were to start driving home now, it would take her approximately {{ states('sensor.alena_driving_time_to_home') }} minutes if she's driving in a car.
          {% elif is_state('sensor.alena_direction_of_travel', 'towards') %}Alena is heading towards home, if she's driving, she should be home in about {{ states('sensor.alena_driving_time_to_home') }} minutes.
          {% elif is_state('sensor.alena_location','Home') %}
          {% else %}Alena is at {{ states('sensor.alena_location') }}. She hasn't started heading home yet. But if she were to start driving home now, it would take her approximately {{ states('sensor.alena_driving_time_to_home') }} minutes if she's driving in a car.
          {% endif %}
 
  - platform: template
    sensors:
      sean_eta_description:
        friendly_name: "Sean ETA description"
        value_template: >-
          {% if now().weekday() in (1,2,3,4,5,) %}
            {% if states('sensor.sean_location') in ['Almost Home','Heading Home','Waiting for Tram','Left Work'] %}Sean is {{ states('sensor.sean_location') }} . If he's coming by tram, it should take approximately {{ states('sensor.sean_tram_time_to_home') }} minutes to arrive.
            {% elif states('sensor.sean_location') in ['Left Home','Heading to Work','Almost at Work','Heading to Center','Heading to Andel','Heading to Hornbach','Heading to WineFood','Heading to P6','Driving','Traveling'] %} Sean is {{ states('sensor.sean_location') }} . He's not heading towards home, but if he were to turn around now and start coming home, it would take approximately {{ states('sensor.sean_tram_time_to_home') }} minutes for him to arrive.
            {% elif is_state('sensor.sean_location', 'Home') %} 
            {% else %} Sean is {{ states('sensor.sean_location') }}. He hasn't started heading home yet. But if he were to start taking the tram home now, it would take him approximately {{ states('sensor.sean_tram_time_to_home') }} minutes.
            {% endif %}
          {% else %}
            {% if states('sensor.sean_location') in ['Almost Home','Heading Home','Waiting for Tram','Left Work'] %}Sean is {{ states('sensor.sean_location') }} . If he's coming by car, it should take approximately {{ states('sensor.sean_driving_time_to_home') }} minutes to arrive.
            {% elif states('sensor.sean_location') in ['Left Home','Heading to Work','Almost at Work','Heading to Center','Heading to Andel','Heading to Hornbach','Heading to WineFood','Heading to P6','Driving','Traveling'] %} Sean is {{ states('sensor.sean_location') }} . He's not heading towards home, but if he were to turn around now and start coming home by car, it would take approximately {{ states('sensor.sean_driving_time_to_home') }} minutes to arrive.
            {% elif is_state('sensor.sean_location', 'Home') %} 
            {% else %}Sean is {{ states('sensor.sean_location') }}. He hasn't started heading home yet. But if he were to start driving home now, it would take him approximately {{ states('sensor.sean_driving_time_to_home') }} minutes tp arrive if he were coming by car.
            {% endif %}
          {% endif %}

  - platform: template
    sensors:
      sophie_eta_description:
        friendly_name: "Sophie ETA description"
        value_template: >-
          {% if now().weekday() in (1,2,3,4,5,) %}
            {% if is_state('sensor.sophie_direction_of_travel', 'away_from') %} Sophie is heading away from home. But if she were to turn around and start heading home now, it would take her approximately {{ states('sensor.sophie_tram_time_to_home') }} minutes if she's in a tram.
            {% elif is_state('sensor.sophie_location', 'Somewhere') %} Sophie is somewhere I don't know. She hasn't started heading home yet, but if she were to start driving home now, it would take her approximately {{ states('sensor.sophie_tram_time_to_home') }} minutes if she's in a tram.
            {% elif is_state('sensor.sophie_direction_of_travel', 'towards') %} Sophie is heading towards home, if she's in a tram, she should be home in about {{ states('sensor.sophie_tram_time_to_home') }} minutes.
            {% elif is_state('device_tracker.sophie', 'home') %} 
            {% else %} Sophie is {{ states('sensor.sophie_location') }}. She hasn't started heading home yet. But if she were to start heading home now, it would take her approximately {{ states('sensor.sophie_tram_time_to_home') }} minutes if she's in a tram.
            {% endif %}
          {% else %}
            {% if is_state('sensor.sophie_direction_of_travel', 'away_from') %} Sophie is heading away from home. But if she were to turn around and start driving home now, it would take her approximately {{ states('sensor.sophie_driving_time_to_home') }} minutes if she's driving in a car.
            {% elif is_state('sensor.sophie_location', 'Somewhere') %} Sophie is somewhere I don't know. She hasn't started heading home yet, but if she were to start driving home now, it would take her approximately {{ states('sensor.sophie_driving_time_to_home') }} minutes if she's driving in a car.
            {% elif is_state('sensor.sophie_direction_of_travel', 'towards') %} Sophie is heading towards home, if she's driving, she should be home in about {{ states('sensor.sophie_driving_time_to_home') }} minutes.
            {% elif is_state('device_tracker.sophie', 'home') %} 
            {% else %} Sophie is {{ states('sensor.sophie_location') }}. She hasn't started heading home yet. But if she were to start driving home now, it would take her approximately {{ states('sensor.sophie_driving_time_to_home') }} minutes if she's driving in a car.
            {% endif %}
          {% endif %}

  - platform: template
    sensors:
      alena_eta:
        friendly_name: "Alena ETA"
        value_template: >-
          {% if is_state('sensor.alena_location','Home') %} Alena is at home.
          {% elif is_state('sensor.alena_direction_of_travel', 'towards') %} Alena ETA: {{ states('sensor.alena_driving_time_to_home') }} minutes by car.
          {% else %} Alena isn't heading home
          {% endif %}

  - platform: template
    sensors:
      sean_eta:
        friendly_name: "Sean ETA"
        value_template: >-
          {% if now().weekday() in (1,2,3,4,5,) %}
            {% if states('sensor.sean_location') in ['Almost Home','Heading Home','Waiting for Tram','Left Work'] %}  Sean ETA: in {{ states('sensor.sean_tram_time_to_home') }} minutes by tram.
            {% elif is_state('sensor.sean_location', 'Home') %} Sean is at home.
            {% else %} Sean isn't heading home
            {% endif %}
          {% else %}
            {% if states('sensor.sean_location') in ['Almost Home','Heading Home','Waiting for Tram','Left Work'] %} Sean ETA: {{ states('sensor.sean_driving_time_to_home') }} minutes by car.
            {% elif is_state('sensor.sean_location', 'Home') %} Sean is at home.
            {% else %} Sean isn't heading home.
            {% endif %}
          {% endif %}

  - platform: template
    sensors:
      sophie_eta:
        friendly_name: "Sophie ETA"
        value_template: >-
          {% if now().weekday() in (1,2,3,4,5,) %}
            {% if is_state('sensor.sophie_direction_of_travel', 'towards') %} Sophie ETA: {{ states('sensor.sophie_tram_time_to_home') }} minutes by tram.
            {% elif is_state('device_tracker.sophie', 'home') %} Sophie is at home.
            {% else %} Sophie isn't heading home
            {% endif %}
          {% else %}
            {% if is_state('sensor.sophie_direction_of_travel', 'towards') %} Sophie ETA: {{ states('sensor.sophie_driving_time_to_home') }} minutes by car.
            {% elif is_state('device_tracker.sophie', 'home') %} Sophie is at home.
            {% else %} Sophie isn't heading home
            {% endif %}
          {% endif %}


  - platform: template
    sensors:
      sebastian_left_window_battery:
        friendly_name: "Sebastian Left Window Battery"
        value_template: >-
          {% if state_attr('zwave.sebastian_room_left_window', 'battery_level')|float < 15 %}
            Very Low
          {% elif state_attr('zwave.sebastian_room_left_window', 'battery_level')|float < 25 %}
            Low
          {% elif state_attr('zwave.sebastian_room_left_window', 'battery_level')|float < 40 %}
            Medium
          {% elif state_attr('zwave.sebastian_room_left_window', 'battery_level')|float < 70 %}
            Good
          {% else %}
            Full
          {% endif %} 

  - platform: template
    sensors:
      basement_flood_sensor_battery:
        friendly_name: "Basement flood sensor battery"
        value_template: >-
          {% if state_attr('zwave.basement_flood_sensor', 'battery_level')|float < 15 %}
            Very Low
          {% elif state_attr('zwave.basement_flood_sensor', 'battery_level')|float < 25 %}
            Low
          {% elif state_attr('zwave.basement_flood_sensor', 'battery_level')|float < 40 %}
            Medium
          {% elif state_attr('zwave.basement_flood_sensor', 'battery_level')|float < 70 %}
            Good
          {% else %}
            Full
          {% endif %} 

  - platform: template
    sensors:
      sean_commute:
        friendly_name: "Sean Commute"
        value_template: >-
          Sean Route to Work: {{ state_attr('sensor.transport_time_to_work', 'route') }} (ETA: {{ states('sensor.transport_time_to_work') }} minutes)

#          Sean Route to Work:
#          {{  state_attr('sensor.transport_time_to_work', 'route')|replace(';','  ') }}          
#          (ETA: {{ states('sensor.transport_time_to_work') }} minutes)

  - platform: template
    sensors:
        last_alexa:
          entity_id:
            - media_player.sean_s_2nd_fire
          value_template: >
            {{ states.media_player | selectattr('attributes.last_called','eq',True) | map(attribute='entity_id') | first }}

