##################################################
# AUTOMATIONS TO TURN DOWN HEAT FOR OPEN WINDOWS #
##################################################


- id: heat_down_open_living_room_auto
  alias: heat_down_open_living_room_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.back_door
    to: 'on'
    for: 
      minutes: 3
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.living_room
      setpoint: 12
      duration: {"minutes":240}
  condition:
    condition: state
    entity_id: input_select.active_heating_profile_living_room
    state: 'LIVING_ROOM_AUTO'
        
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}

# - id: heat_down_open_living_room_profile
#   alias: heat_down_open_living_room_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.back_door
#     to: 'on'
#     for: 
#       minutes: 3
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.living_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile_living_room
#         state: 'LIVING_ROOM_20'
#       - condition: state
#         entity_id: input_select.active_heating_profile_living_room
#         state: 'LIVING_ROOM_18'

- id: heat_up_closed_living_room_auto
  alias: heat_up_closed_living_room_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.back_door
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.living_room
  condition:
    condition: state
    entity_id: input_select.active_heating_profile_living_room
    state: 'LIVING_ROOM_AUTO'

# - id: heat_up_closed_living_room_profile
#   alias: heat_up_closed_living_room_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.back_door
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.living_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'
#       - condition: state
#         entity_id: input_select.active_heating_profile_living_room
#         state: 'LIVING_ROOM_20'
#       - condition: state
#         entity_id: input_select.active_heating_profile_living_room
#         state: 'LIVING_ROOM_18'

- id: heat_down_open_sophies_room_auto
  alias: heat_down_open_sophies_room_auto
  trigger:
    platform: state
    entity_id: binary_sensor.sophies_room_ceiling_window
    to: 'on'
    for: 
      minutes: 3
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.sophie_s_room
      setpoint: 12
      duration: {"minutes":240}
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}


# - id: heat_down_open_sophies_room_profile
#   alias: heat_down_open_sophies_room_profile
#   trigger:
#     platform: state
#     entity_id: binary_sensor.sophies_room_ceiling_window
#     to: 'on'
#     for: 
#       minutes: 3
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.sophie_s_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_up_closed_sophies_room_auto
  alias: heat_up_closed_sophies_room_auto
  trigger:
    platform: state
    entity_id: binary_sensor.sophies_room_ceiling_window
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.sophie_s_room
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'

# - id: heat_up_closed_sophies_room_profile
#   alias: heat_up_closed_sophies_room_profile
#   trigger:
#     platform: state
#     entity_id: binary_sensor.sophies_room_ceiling_window
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.sophie_s_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_down_open_sebastians_room_auto
  alias: heat_down_open_sebastians_room_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.sebastians_room_left_window
    to: 'on'
    for: 
      minutes: 3
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.sebastian_s_room
      setpoint: 12
      duration: {"minutes":240}
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}

# - id: heat_down_open_sebastians_room_profile
#   alias: heat_down_open_sebastians_room_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.sebastians_room_left_window
#     to: 'on'
#     for: 
#       minutes: 3
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.sebastian_s_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_up_closed_sebastians_room_auto
  alias: heat_up_closed_sebastians_room_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.sebastians_room_left_window
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.sebastian_s_room
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'

# - id: heat_up_closed_sebastians_room_profile
#   alias: heat_up_closed_sebastians_room_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.sebastians_room_left_window
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.sebastian_s_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_down_open_master_closet_auto
  alias: heat_down_open_master_closet_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.ecolink_closet_left_window
    to: 'on'
    for: 
      minutes: 2
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.master_closet
      setpoint: 12
      duration: {"minutes":240}
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}

# - id: heat_down_open_master_closet_profile
#   alias: heat_down_open_master_closet_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.ecolink_closet_left_window
#     to: 'on'
#     for: 
#       minutes: 2
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.master_closet
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_up_closed_master_closet_auto
  alias: heat_up_closed_master_closet_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.ecolink_closet_left_window
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.master_closet
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'

# - id: heat_up_closed_master_closet_profile
#   alias: heat_up_closed_master_closet_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.ecolink_closet_left_window
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.master_closet
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_down_open_laundry_auto
  alias: heat_down_open_laundry_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.laundry_room_window_zone_13
    to: 'on'
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.laundry_room
      setpoint: 12
      duration: {"minutes":240}
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.active_heating_profile
        state: 'PROFILE_AUTO'
      - condition: state
        entity_id: input_select.active_heating_profile
        state: 'PROFILE_A'
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}

# - id: heat_down_open_laundry_profile
#   alias: heat_down_open_laundry_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.laundry_room_window_zone_13
#     to: 'on'
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.laundry_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_up_closed_laundry_auto
  alias: heat_up_closed_laundry_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.laundry_room_window_zone_13
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.laundry_room
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.active_heating_profile
        state: 'PROFILE_AUTO'
      - condition: state
        entity_id: input_select.active_heating_profile
        state: 'PROFILE_A'

# - id: heat_up_closed_laundry_profile
#   alias: heat_up_closed_laundry_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.laundry_room_window_zone_13
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.laundry_room
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_down_open_garage_auto
  alias: heat_down_open_garage_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.ecolink_garage_door
    to: 'on'
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.garage
      setpoint: 5
      duration: {"minutes":240}
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'
#  condition:
#    condition: template 
#    value_template: > 
#      {{ state_attr('climate.living_room', 'status').setpoint_status.setpoint_mode in 'FollowSchedule' }}

# - id: heat_down_open_garage_profile
#   alias: heat_down_open_garage_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.ecolink_garage_door
#     to: 'on'
#   action:
#     service: climate.turn_off
#     data:
#       entity_id: climate.garage
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'

- id: heat_up_closed_garage_auto
  alias: heat_up_closed_garage_auto
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: binary_sensor.ecolink_garage_door
    to: 'off'
  action:   
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.garage
  condition:
    condition: state
    entity_id: input_select.active_heating_profile
    state: 'PROFILE_AUTO'

# - id: heat_up_closed_garage_profile
#   alias: heat_up_closed_garage_profile
#   initial_state: 'true'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.ecolink_garage_door
#     to: 'off'
#   action:
#     service: climate.turn_on
#     data:
#       entity_id: climate.garage
#   condition:
#     condition: or
#     conditions:
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_A'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_B'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_C'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_D'
#       - condition: state
#         entity_id: input_select.active_heating_profile
#         state: 'PROFILE_E'


######################################################
# AUTOMATIONS TO ADJUST HEAT BASED ON WEATHER REPORT #
######################################################
# this shit all got replaced by a badass python script
# that runs once a day at 12:30 AM

- id: set_heat_overrides_for_warm_weather
  alias: set_heat_overrides_for_warm_weather
  initial_state: 'true'
  trigger:
    platform: time
    at: '00:30:00'
  action:
    - service: python_script.set_heat_weather_override

#
#- id: warm_sunny_weather_heat_down
#  alias: 'Turn Down Heat For Warm Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 4
#        below: 11
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 12
#        below: 21
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'clear-day'
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.dining_room
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.entrance
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.garage
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bath
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bedroom
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_closet
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.office_library
#        setpoint: 21.5
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.laundry_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#
#- id: warm_cloudy_weather_heat_down
#  alias: 'Turn Down Heat For Warm Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 6
#        below: 11
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 14
#        below: 21
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'partly-cloudy-day'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'rain'          
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'snow'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'sleet'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'wind'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'fog'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'cloudy'     
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.dining_room
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.entrance
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.garage
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bath
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bedroom
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_closet
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.office_library
#        setpoint: 21.5
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#        setpoint: 22
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.laundry_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#                
#- id: cold_weather_heat_auto_sunny
#  alias: 'Turn Heat to Schedule in Cold Sunny Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        below: 5
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        below: 13
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'clear-day'
#  action:
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.dining_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.entrance
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.garage
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.living_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_bedroom
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_bath
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_closet
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.office_library
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.laundry_room
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_on
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_on
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#
#- id: cold_weather_heat_auto_cloudy
#  alias: 'Turn Heat to Schedule in Cold Cloudy Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        below: 7
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        below: 15
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'partly-cloudy-day'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'rain'          
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'snow'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'sleet'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'wind'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'fog'
#          - condition: state
#            entity_id: sensor.dark_sky_icon_0d
#            state: 'cloudy'
#  action:
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.dining_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.entrance
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.garage
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.living_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_bedroom
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_bath
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.master_closet
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.office_library
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.laundry_room
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_on
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_on
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_on
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#
#- id: living_room_tepid_weather_heat_down
#  alias: 'Turn Living Room Heat Down For Tepid Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 1
#        below: 11
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 10
#        below: 21
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 20
#        duration: {"minutes":1439}
#
#- id: living_room_warm_weather_heat_down
#  alias: 'Turn Living Room Heat Down For Warm Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 4
#        below: 11
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 12
#        below: 21
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 18
#        duration: {"minutes":1439}
#
#- id: living_room_cold_weather_heat_up
#  alias: 'Turn Living Room Heat Up For Cold Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        below: 2
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        below: 11
#  action:
#    - service: evohome.clear_zone_override
#      data:
#        entity_id: climate.living_room
#
#- id: warmer_weather_heat_down_more
#  alias: 'Turn Down Heat More For Warmer Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 9
#        below: 14
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 19
#        below: 24
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.dining_room
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.entrance
#        setpoint: 16
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.garage
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 16
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bath
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bedroom
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_closet
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.office_library
#        setpoint: 20
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.laundry_room
#        setpoint: 21
#        duration: {"minutes":1439}
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#
#- id: warmer_weather_heat_down_more_2
#  alias: 'Turn Down Heat For Warm Weather 2'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 11
#        below: 15
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 22
#        below: 26
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.dining_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.entrance
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.garage
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bath
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bedroom
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_closet
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.office_library
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#        setpoint: 18
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.laundry_room
#        setpoint: 19
#        duration: {"minutes":1439}
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home
#
#- id: hot_weather_turn_heat_off
#  alias: 'Turn Heat Off For Hot Weather'
#  initial_state: 'true'
#  trigger:
#    platform: time
#    at: '00:30:00'
#  condition:
#    condition: and
#    conditions:
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_overnight_low_temperature_0d'
#        above: 14
#      - condition: numeric_state
#        entity_id: 'sensor.dark_sky_daytime_high_temperature_0d'
#        above: 25
#  action:
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.dining_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.entrance
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.garage
#        setpoint: 12
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.guest_bedroom
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.living_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bath
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_bedroom
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.master_closet
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.office_library
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sebastian_s_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.sophie_s_room
#        setpoint: 15
#        duration: {"minutes":1439}
#    - service: evohome.set_zone_override
#      data:
#        entity_id: climate.laundry_room
#        setpoint: 12
#        duration: {"minutes":1439}
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_down_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_heat_up_in_living_room
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_today
#    - service: homeassistant.turn_off
#      entity_id: automation.working_from_home_now
#    - service: homeassistant.turn_off
#      entity_id: automation.turn_up_the_heat_in_sophie_s_room_if_she_s_home


####################################################
# Special Heating Cases Based on Location or Input #
####################################################

- id: sophie_room_heat_up_if_home
  alias: "Turn up the heat in sophie's room if she's home"
  initial_state: 'true'
  trigger:
    platform: time
    at: '7:50:00'
  condition:    
    condition: and
    conditions:
      - condition: state
        entity_id: 'device_tracker.sophie'
        state: 'home'
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri    
  action:
    - service: evohome.set_zone_override
      data:
        entity_id: climate.sophie_s_room
        setpoint: 23
        duration: {"minutes":500}

- id: fire_in_fireplace_tomorrow
  alias: "Fire in Fireplace Tomorrow"
  initial_state: 'true'
  trigger:
    platform: time
    at: '6:00:00'
  condition:    
    condition: state
    entity_id: input_boolean.fire_in_fireplace_tomorrow
    state: 'on'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.fire_in_fireplace_tomorrow
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.fire_in_fireplace_now

- id: fire_in_fireplace_now
  alias: "Fire in Fireplace Now"
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: input_boolean.fire_in_fireplace_now
    to: 'on'
  action:
    - service: evohome.set_zone_override
      data:
        entity_id: climate.dining_room
        setpoint: 21
        duration: {"minutes":840}
    - service: evohome.set_zone_override
      data:
        entity_id: climate.entrance
        setpoint: 21
        duration: {"minutes":840}
    - service: evohome.set_zone_override
      data:
        entity_id: climate.living_room
        setpoint: 21
        duration: {"minutes":840}

- id: fire_in_fireplace_now_turned_off
  alias: "Fire in Fireplace Now Off"
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: input_boolean.fire_in_fireplace_now
    to: 'off'
  action:
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.dining_room
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.entrance
    - service: evohome.clear_zone_override
      data:
        entity_id: climate.living_room

- id: working_from_home_now
  alias: "Working From Home Now"
  initial_state: 'true'
  trigger:
    platform: state
    entity_id: input_boolean.working_from_home
    to: 'on'
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.office_library
      setpoint: 23
      duration: {"minutes":480}

- id: working_from_home_today
  alias: "Working From Home Today"
  initial_state: 'true'
  trigger:
    platform: time
    at: '10:00:00'
  condition:    
    - condition: state
      entity_id: input_boolean.working_from_home
      state: 'on'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri    
  action:
    service: evohome.set_zone_override
    data:
      entity_id: climate.office_library
      setpoint: 23
      duration: {"minutes":700}

#####################################
# Non heating related climate cases #
#####################################

- id: notify_windy_weather
  alias: 'Notify About Windy Weather'
  initial_state: 'true'
  trigger:
    minutes: '/60'
    platform: time_pattern
  condition:
    condition: template 
    value_template: >
      {{ if (states('sensor.dark_sky_wind_gust_1h')|float > 20) or (states('sensor.dark_sky_wind_gust_2h')|float > 20) or (states('sensor.dark_sky_wind_gust_3h')|float > 20) or (states('sensor.dark_sky_wind_gust_4h')|float > 20) or (states('sensor.dark_sky_wind_gust_5h')|float > 20) or (states('sensor.dark_sky_wind_gust_6h')|float > 20) or (states('sensor.dark_sky_wind_gust_7h')|float > 20) or (states('sensor.dark_sky_wind_gust_8h')|float > 20) or (states('sensor.dark_sky_wind_gust_9h')|float > 20) }}
  action:
    service: notify.mobile_app_sean_s_iphone_x
    data:
      title: "High Winds Warning"
    data_template:
      message: >
        {% if states('sensor.dark_sky_wind_gust_1h')|float > 20 %}
        High winds expected in the next hour. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_2h')|float > 20 %}
        High winds expected in 2 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_3h')|float > 20 %}
        High winds expected in 3 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_4h')|float > 20 %}
        High winds expected in 4 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_5h')|float > 20 %}
        High winds expected in 5 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_6h')|float > 20 %}
        High winds expected in 6 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_7h')|float > 20 %}
        High winds expected in 7 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_8h')|float > 20 %}
        High winds expected in 8 hours. Please secure items outside.
        {% elif states('sensor.dark_sky_wind_gust_9h')|float > 20 %}
        High winds expected in 9 hours. Please secure items outside.
        {% else %}
        Error
        {% endif %}
